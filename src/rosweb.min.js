var ROSLIB=require("./roslibjs/src/RosLibNode.js"),events=require("events"),event=new events.EventEmitter,fs=require("fs"),topic_path="../config/rostopic.txt",type_path="../config/rostype.txt",topics=[],topics_len,types=[];fs.readFile(topic_path,function(a,c){topics=c.toString().split("\n");topics_len=c.toString().split("\n").length-1;console.log("reading"+topic_path);for(var b=0;b<topics_len;b++)console.log(topics[b])});
fs.readFile(type_path,function(a,c){types=c.toString().split("\n");console.log("reading"+type_path);for(var b=0;b<topics_len;b++)console.log(types[b])});for(var rostopics=Array(topics_len),rosmessage=Array(topics_len),i=0;i<topics_len;i++)rosmessage[i]=new ROSLIB.Message;var ros=new ROSLIB.Ros({url:"ws://localhost:9090"});
ros.on("connection",function(){console.log("Connected to websocket server.");event.on("subscribe",function(){for(var a=0;a<topics_len;a++)rostopics[a].subscribe(function(c){rosmessage[a]=c;console.log("subscribing "+rostopics[a]);console.log("publishing "+rostopics[a]);rostopics[a].unsubscribe()}),rostopics[a].publish(rosmessage[a]);event.emit("finished publishing and subscribing");event.emit("done")});event.on("create topic",function(){for(var a=0;a<topics_len;a++)rostopics[a]=new ROSLIB.Topic({ros:ros,
name:topics[a],messageType:types[a]});console.log("created topic")});(function(a){event.on("done",a);process.nextTick(function(){event.emit("create topic");process.nextTick(function(){event.emit("subscribe")})})})(function(){console.log("finished callback")})});ros.on("error",function(a){console.log("Error connecting to websocket server: ",a)});ros.on("close",function(){console.log("Connection to websocket server closed.")});
